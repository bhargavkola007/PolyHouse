<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Temperature Data Visualization</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="visualisation.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
    <h2>ğŸ“Š Temperature Data Visualization</h2>
  </header>

  <main class="container">
    <div class="stats-grid">
  <div class="stat-card">
    <h4>ğŸŒ¡ï¸ Min Temp</h4>
    <p id="minTemp">-- Â°C</p>
  </div>
  <div class="stat-card">
    <h4>ğŸ”¥ Max Temp</h4>
    <p id="maxTemp">-- Â°C</p>
  </div>
  <div class="stat-card">
    <h4>ğŸ“Š Avg Temp</h4>
    <p id="avgTemp">-- Â°C</p>
  </div>
</div>

<div class="charts-grid">
  <div class="chart-container">
    <h3>ğŸŒ¡ Temperature Over Time</h3>
    <canvas id="tempChart"></canvas>
  </div>

  <div class="chart-container">
    <h3>ğŸ“Š Average Temperature</h3>
    <canvas id="avgChart"></canvas>
  </div>

  <div class="chart-container">
    <h3>ğŸ¥§ Temperature Distribution</h3>
    <canvas id="pieChart"></canvas>
  </div>
</div>


    <div class="back-btn">
      <button onclick="window.location.href='viewdata.html'">â¬…ï¸ Back to Live Data</button>
    </div>
  </main>

  <footer>
    <p>Â© 2025 Centurion University | IoT Polyhouse Temperature Monitoring</p>
  </footer>

  <script>
const API_ROOT =
  window.location.hostname === "localhost"
    ? "http://localhost:8080/sensors"
    : "https://polyhouse-qqiy.onrender.com/sensors";

async function loadData() {
  try {
    const res = await fetch(`${API_ROOT}/data`);
    return await res.json();
  } catch {
    return [];
  }
}

function calculateStats(temps) {
  const min = Math.min(...temps);
  const max = Math.max(...temps);
  const avg = (temps.reduce((a, b) => a + b, 0) / temps.length).toFixed(2);

  document.getElementById("minTemp").innerText = `${min} Â°C`;
  document.getElementById("maxTemp").innerText = `${max} Â°C`;
  document.getElementById("avgTemp").innerText = `${avg} Â°C`;
}

function drawLineChart(labels, temps) {
  new Chart(tempChart, {
    type: 'line',
    data: {
      labels,
      datasets: [{
        label: 'Water Temperature (Â°C)',
        data: temps,
        borderColor: '#f57c00',
        backgroundColor: 'rgba(245,124,0,0.2)',
        fill: true,
        tension: 0.4
      }]
    }
  });
}

function drawBarChart(labels, temps) {
  new Chart(avgChart, {
    type: 'bar',
    data: {
      labels,
      datasets: [{
        label: 'Temperature',
        data: temps,
        backgroundColor: '#059669'
      }]
    }
  });
}

function drawPieChart(temps) {
  const ranges = {
    Cold: temps.filter(t => t < 20).length,
    Normal: temps.filter(t => t >= 20 && t <= 30).length,
    Hot: temps.filter(t => t > 30).length
  };

  new Chart(pieChart, {
    type: 'pie',
    data: {
      labels: Object.keys(ranges),
      datasets: [{
        data: Object.values(ranges),
        backgroundColor: ['#3b82f6', '#22c55e', '#ef4444']
      }]
    }
  });
}

(async () => {
  const data = await loadData();
  const labels = data.map(d => d.timestamp);
  const temps = data.map(d => d.waterTemperature);

  calculateStats(temps);
  drawLineChart(labels, temps);
  drawBarChart(labels, temps);
  drawPieChart(temps);
})();
</script>

</body>
</html>
